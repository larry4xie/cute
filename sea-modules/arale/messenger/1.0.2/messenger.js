define("arale/messenger/1.0.2/messenger",["$"],function(a,b,c){function e(a){var b=a.target||parent;try{d.isWindow(b)||(b=d(b).get(0),b&&"IFRAME"===b.tagName&&(b=b.contentWindow))}catch(c){}this.win=b,this.onmessage=a.onmessage||function(){},this.init()}var d=a("$");e.prototype.init=function(){var a=this;this._receiver=function(b){b.source==a.win&&(a.onmessage||function(){}).call(a,b.data)},window.addEventListener?window.addEventListener("message",this._receiver,!1):window.attachEvent&&window.attachEvent("onmessage",this._receiver)},e.prototype.send=function(a){this.win.postMessage(a,"*")},!window.postMessage&&window.attachEvent&&(e.prototype.init=function(){var a=!1;try{a=!!this.win.location.href}catch(b){}return a?(this.send=this.sendForSameOrigin,this.initForSameOrigin(),void 0):(this.queue=[],window.parent==this.win?this.initForParent():this.initForFrame(),void 0)},e.prototype.initForSameOrigin=function(){var a=this;this._dataavailable=function(b){b.eventType&&"message"===b.eventType&&b.eventSource==a.win&&(a.onmessage||function(){}).call(a,b.eventData)},document.attachEvent("ondataavailable",this._dataavailable)},e.prototype.sendForSameOrigin=function(a){var b=this;setTimeout(function(){var c=b.win.document.createEventObject();c.eventType="message",c.eventSource=window,c.eventData=a,b.win.document.fireEvent("ondataavailable",c)})},e.prototype.initForParent=function(){var a=document.createDocumentFragment(),b="width: 1px; height: 1px; position: absolute; left: -999px; top: -999px;",c=document.createElement("iframe");c.src='javascript:""',c.style.cssText=b,a.appendChild(c);var d=document.createElement("iframe");d.src='javascript:""',d.style.cssText=b,a.appendChild(d),document.body.insertBefore(a,document.body.firstChild),this.senderWin=c.contentWindow,this.receiverWin=d.contentWindow,this.startReceive(),this._fragment=a},e.prototype.initForFrame=function(){this.senderWin=null,this.receiverWin=null;var a=this;this.timerId=setInterval(function(){a.waitForFrame()},50)},e.prototype.waitForFrame=function(){var a,b;try{a=this.win[1],b=this.win[0]}catch(c){}a&&b&&(clearInterval(this.timerId),this.senderWin=a,this.receiverWin=b,this.queue.length&&this.flush(),this.startReceive())},e.prototype.startReceive=function(){var a=this;this.timerId=setInterval(function(){a.tryReceive()},50)},e.prototype.tryReceive=function(){try{return this.receiverWin.name,void 0}catch(a){}this.receiverWin.location.replace('javascript:"";');var b=this;setTimeout(function(){b.receive()},0)},e.prototype.receive=function(){var a=null;try{a=this.receiverWin.name}catch(b){}if(a){this.receiverWin.name="";for(var c=this,d=a.substring(1).split("|"),e=0;d.length>e;e++)(function(){var a=decodeURIComponent(d[e]);setTimeout(function(){(c.onmessage||function(){}).call(c,a)},0)})()}},e.prototype.send=function(a){this.queue.push(a),this.senderWin&&this.flush()},e.prototype.flush=function(){for(var a=[],b=0;this.queue.length>b;b++)a[b]=encodeURIComponent(this.queue[b]);var c="|"+a.join("|");try{this.senderWin.name+=c,this.queue.length=0}catch(d){this.senderWin.location.replace("about:blank");var e=this;setTimeout(function(){e.flush()},0)}}),e.prototype.destroy=function(){clearInterval(this.timerId),this._receiver&&(window.removeEventListener?window.removeEventListener("message",this._receiver,!1):window.detachEvent&&window.detachEvent("onmessage",this._receiver)),document.detachEvent&&this._dataavailable&&document.detachEvent("ondataavailable",this._dataavailable),this._fragment&&document.body.removeChild(this._fragment);for(var a in this)this.hasOwnProperty(a)&&delete this[a]},c.exports=e});